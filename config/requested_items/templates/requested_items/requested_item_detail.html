{% extends "core/base.html" %}

{% load static %}
{% load i18n %}
{% load humanize %}
{% load app_extras %}  {# custom tag #}

{% block title %}
	<title>{{ requested_item.item_requested }}</title>
{% endblock %}

{% block extra_css %}
	<link rel="stylesheet" href="{% static 'css/requested_items.css' %}">
{% endblock extra_css %}

{% block institution_searchbox %}
{% endblock %}

{% block content %}
<!-- 100% wide until lg. (At lg it turns to container.) -->
<div class="container-lg mb-5">
	<article class="d-flex flex-column shadow rounded p-3 mb-5 requested-item-art">
		<h2 class="text-capitalize">{{ requested_item.item_requested }}</h2>
		<span class="text-muted mb-3" title="{{ requested_item.posted_datetime }}">
			{% trans 'Posted' %} {{ requested_item.posted_datetime|naturaltime }}
		</span>
		
		{% if photos.exists %}
			<section class="mb-5 requested-item-photo-section">
				<div class="row mb-4 photo-slide">
					{% for photo in photos %}
					<div class="col-4 col-lg-3 my-2"> 
						<img 
							src="{{ photo.file.url }}"
							class="photo-slide__img js-photo-slide__img"
							alt="{{ photo.title }}"
						> 
					</div>
					{% endfor %}
				</div>
				<img class="w-100 expanded-img js-expanded-img">
			</section>
		{% endif %}

		<!-- item description -->
		<div class="mb-5">
			<h3 class="mb-3">{% trans 'Description' %}</h3>
			<p>{{ requested_item.item_description }}</p>
		</div>
			
		<!-- contact details -->
		<section class="contact-details">
			<h4 class="text-success">{% trans 'Contact' %} {{ requested_item.contact_name }}</h4>
			<div class="fs-4 px-3 mb-3 shadow-sm rounded number-box-wrp">
				{% for phone_number in contact_numbers %}
					{% with phone_number.number as number %}
					<div class="py-2 d-flex justify-content-between number-box">
						<a 
							href="tel: {{ number }}" 
							class="text-dark text-decoration-none number-box__tel"
						>
							{# properly print tel using custom template filter #}
							{{ number|parse_tel }}
						</a>
						{% if phone_number.can_whatsapp %}
							<a 
								href="https://wa.me/237{{ number }}" 
								class="text-success number-box__whatsapp"
								data-bs-toggle="tooltip"
								title="{% trans 'Contact via WhatsApp' %}"
							>
								<i class="fab fa-whatsapp"></i>
							</a>
						{% endif %}
					</div>
					{% endwith %}
				{% endfor %}
			</div>
		</section>
	</article>
</div>
{% endblock content %}

{% block extra_js %}
<script>
	{% if photos.exists %}
		var $images = $('.js-photo-slide__img');
		$images.on('click', {$images: $images}, expandImage);
		
		var $firstImg = $images.first(), firstImg = $firstImg.get(0);
		$firstImg.css('border', '2px inset #198754');
		var $expandedImg = $('.js-expanded-img');
		$expandedImg.attr({'src': firstImg.src, 'alt': firstImg.alt});
	{% endif %}

	// initialize all tooltips on the page
	var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
	var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
		return new bootstrap.Tooltip(tooltipTriggerEl);
	});
</script>
{% endblock %}