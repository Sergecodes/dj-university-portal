{% extends "core/base.html" %}

{% load static %}
{% load i18n %}
{% load crispy_forms_tags %}
{% comment %} {% load humanize %} {% endcomment %}
{% comment %} {% load app_extras %}  {# custom tag #} {% endcomment %}

{% block title %}
	{% get_current_language as LANGUAGE_CODE %}
	<title>
		{% if LANGUAGE_CODE == 'fr' %}
			{% trans 'Epreuve de' %} {{ past_paper.title }}
		{% else  %}
			{{ past_paper.title }} {% trans 'paper' %}
		{% endif %}
	 | CamerSchools</title>
{% endblock %}

{% block extra_css %}
	<link rel="stylesheet" href="{% static 'css/past_papers.css' %}">
{% endblock extra_css %}

{% block institution_searchbox %}
{% endblock %}

{% block content %}
<!-- 100% wide until lg. (At lg it turns to container.) -->
<div class="container-lg">
	<article class="border mb-4 p-3 ">
		<div class="d-flex justify-content-between">
			<h2 class="mb-2">{{ past_paper.title }}</h2>
			<a class="btn btn-warning" href="{% url 'past_papers:past-paper-upload' %}">
				{% trans 'Upload a past paper' %}
			</a>
		</div>
		<section class="text-muted mb-4">
			<span class="text-muted">{% trans 'Uploaded on' %}</span>
			{{ past_paper.posted_datetime|date:'d M, Y' }}
			{% trans 'by' %}
			{% with poster=past_paper.poster %}
			{% if poster.has_social_profile %}
				<a 
					class="text-decoration-none" 
					href="{{ poster.get_absolute_url }}"
				>
					{{ poster.full_name }}
				</a>
			{% else %}
				<span title="{% blocktrans %} User doesn't have a social profile {% endblocktrans %}">
					{{ poster.full_name }}
				</span>
			{% endif %}
			{% endwith %}
			{% if past_paper.school %}
				{% trans 'for' %}
				<a href="{% url 'past_papers:past-paper-list' %}?school={{ past_paper.school_id }}" class="text-decoration-none">{{ past_paper.school }}</a>
			{% endif %}
			{% with view_count=past_paper.view_count %}
			<div>
				{% trans 'Views' %}:
				<span class="ms-2">
					{{ view_count }}
					<i class="far fa-eye ms-1" aria-hidden="true"></i>
				</span>
			</div>
			{% endwith %}
		</section>

		{# file viewer #}
		<section>
			{# use googledocs viewer after deployment #}
			{% comment %} <iframe src="https://docs.google.com/gview?url=http://path.com/to/your/pdf.pdf&embedded=true" style="width:600px; height: 500px;" frameborder="0">
			</iframe> {% endcomment %}

			<object data="{{ past_paper.file.url }}" type="application/pdf" width="100%" height="700px">
			</object>
		</section>
		<a href="{{ past_paper.file.url }}" class="btn btn-primary mb-5" download>
			<i class="fas fa-file-download me-1" aria-hidden="true"></i>
			{% trans 'Download file' %}
		</a>

		{# comments section #}
		<section class="mb-2">
			{% if comments.exists %}
				<h5>
					{% blocktrans count num_comments=comments.count with title=past_paper.title %}
						{{ num_comments }} comment on <strong>{{ title }}</strong>
						{% plural %}
						{{ num_comments }} comments on <strong>{{ title }}</strong>
					{% endblocktrans %}
				</h5>
				<ul class="list-group list-group-flush pe-4 mb-3">
					{% for comment in page_obj %}
						<li class="list-group-item pb-3 mb-2 ms-2 {% if forloop.first %} pt-3 {% endif %}">
							<p class="text-break m-0">{{ comment.content }}</p>
							{% comment %} <span class="text-muted">&nbsp; - &nbsp;</span> {% endcomment %}
							<a 
								href="{{ comment.poster.get_absolute_url }}" 
								class="text-decoration-none"
							>
								{{ comment.poster.username }}
							</a>
							<span class="text-muted" title="{{ comment.posted_datetime }}">&nbsp; - &nbsp; {{ comment.posted_datetime|date:'d M, Y' }}</span>
						</li> 
					{% endfor %}
				</ul>
						
				{% if is_paginated %}
					{% include 'core/pagination.html' with page_obj=page_obj %}
				{% endif %}
			{% endif %}
			
			<hr class="mb-4">
			{# form to add comment #}
			<form method="post" class="pastpaper-comment-form">
				<h4>{% trans 'Leave a comment' %}</h4>
				{% csrf_token %}		
				{{ comment_form|crispy }}
				{{ comment_form.fields.poster }}
				{{ comment_form.fields.past_paper }}

				<input type="hidden" name="past_paper_id" value="{{ past_paper.id }}">
				<input type="submit" class="btn btn-sm btn-secondary" value="{% trans 'Add comment' %}">
			</form>
		</section>
	</article>

	{% if similar_papers.exists %}
		<section class="border p-3">
			<h4 class="mb-3 opacity-75">
				{% blocktrans with subject=past_paper.subject.name level=past_paper.get_level_display %}
					Some similar <span class="fw-bold">{{ subject }}</span> 
					papers for <span class="fw-bold">{{ level }}</span>
				{% endblocktrans %}
			</h4>
			<ul class="list-group list-group-flush">
				{% for similar_paper in similar_papers %}
					<li class="list-group-item pb-3 mb-2">
						<a 
							href="{{ similar_paper.get_absolute_url }}" 
							class="text-decoration-none"
						>
							{{ similar_paper.title }}
						</a>
					</li> 
				{% endfor %}
			</ul>
		</section>
	{% endif %}
	<div class="mb-5">
</div>
{% endblock content %}

{% block extra_js %}
{% endblock %}