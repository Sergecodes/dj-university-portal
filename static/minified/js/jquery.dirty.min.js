!function(a){function e(i){i.form.find("input, select, textarea").on("change.dirty click.dirty keyup.dirty keydown.dirty blur.dirty",function(t){i.checkValues(t)}),i.form.on("dirty",function(){i.options.onDirty()}),i.form.on("clean",function(){i.options.onClean()})}function n(t,i){this.form=t,this.isDirty=!1,this.options=i,this.history=[s,s],this.id=a(t).attr("id"),r.push(this)}var r=[],t="dirty",s="clean",o="dirtyInitialValue";n.prototype={init:function(){this.saveInitialValues(),this.setEvents()},isRadioOrCheckbox:function(t){return a(t).is(":radio, :checkbox")},isFileInput:function(t){return a(t).is(":file")},saveInitialValues:function(){var n=this;this.form.find("input, select, textarea").each(function(t,i){var e=n.isRadioOrCheckbox(i),s=n.isFileInput(i);e?(e=a(i).is(":checked")?"checked":"unchecked",a(i).data(o,e)):s?a(i).data(o,JSON.stringify(i.files)):a(i).data(o,a(i).val()||"")})},refreshEvents:function(){var t;(t=this).form.find("input, select, textarea").off("change.dirty click.dirty keyup.dirty keydown.dirty blur.dirty"),t.form.off("dirty"),t.form.off("clean"),e(this)},showDirtyFields:function(){return this.form.find("input, select, textarea").filter(function(t,i){return a(i).data("isDirty")})},setEvents:function(){var i;(i=this).form.on("submit",function(){i.submitting=!0}),i.options.preventLeaving&&a(window).on("beforeunload",function(t){if(i.isDirty&&!i.submitting)return t.preventDefault(),i.options.leavingMessage}),e(this)},isFieldDirty:function(t){var i=t.data(o);null==i&&(i="");var e=t.val();null==e&&(e="");t=/^(true|false)$/i;return t.test(i)&&t.test(e)?!new RegExp("^"+i+"$","i").test(e):e!==i},isFileInputDirty:function(t){var i=t.data(o),t=t[0];return JSON.stringify(t.files)!==i},isCheckboxDirty:function(t){return t.data(o)!==(t.is(":checked")?"checked":"unchecked")},checkValues:function(t){var n=this,r=!1;this.form.find("input, select, textarea").each(function(t,i){var e=n.isRadioOrCheckbox(i),s=n.isFileInput(i),i=a(i),s=e?n.isCheckboxDirty(i):s?n.isFileInputDirty(i):n.isFieldDirty(i);i.data("isDirty",s),r|=s}),r?n.setDirty():n.setClean()},setDirty:function(){this.isDirty=!0,this.history[0]=this.history[1],this.history[1]=t,(this.options.fireEventsOnEachChange||this.wasJustClean())&&this.form.trigger("dirty")},setClean:function(){this.isDirty=!1,this.history[0]=this.history[1],this.history[1]=s,(this.options.fireEventsOnEachChange||this.wasJustDirty())&&this.form.trigger("clean")},wasJustDirty:function(){return this.history[0]===t},wasJustClean:function(){return this.history[0]===s},setAsClean:function(){this.saveInitialValues(),this.setClean()},setAsDirty:function(){this.saveInitialValues(),this.setDirty()},resetForm:function(){var r=this;this.form.find("input, select, textarea").each(function(t,i){var e=a(i),s=r.isRadioOrCheckbox(i),n=r.isFileInput(i);s&&(s="checked"===e.data(o),e.prop("checked",s)),n?(i.value="",a(i).data(o,JSON.stringify(i.files))):(i=e.data(o),e.val(i))}),this.checkValues()}},a.fn.dirty=function(e){if("string"==typeof e&&/^(isDirty|isClean|refreshEvents|resetForm|setAsClean|setAsDirty|showDirtyFields)$/i.test(e)){var t=(i=a(this).attr("id"),r.forEach(function(t){t.id===i&&(s=t)}),s);switch(t||(t=new n(a(this),e)).init(),e.toLowerCase()){case"isclean":return!t.isDirty;case"isdirty":return t.isDirty;case"refreshevents":t.refreshEvents();case"resetform":t.resetForm();case"setasclean":return t.setAsClean();case"setasdirty":return t.setAsDirty();case"showdirtyfields":return t.showDirtyFields()}}else if("object"==typeof e||!e)return this.each(function(t,i){e=a.extend({},a.fn.dirty.defaults,e),new n(a(i),e).init()});var i,s},a.fn.dirty.defaults={preventLeaving:!1,leavingMessage:"There are unsaved changes on this page which will be discarded if you continue.",onDirty:a.noop,onClean:a.noop,fireEventsOnEachChange:!1}}(jQuery);