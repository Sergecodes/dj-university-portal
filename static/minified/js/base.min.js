"use strict";var lastWidth,NAV_LINK_ACTIVE_COLOR="#0e1e0a",CURRENT_NAV_LINK_CLASS="nav-menu__link--current",MIN_PASSWORD_LENGTH=8,MIN_LISTING_PHOTOS=3,$window=$(window),isMobile=window.matchMedia("only screen and (max-width: 991.98px)").matches;function headerDropdownHover(){var e=$(this).children(".dropdown-menu");e.show();var t=$(this).children("a:first-child");t.hasClass(CURRENT_NAV_LINK_CLASS)||t.css("color",NAV_LINK_ACTIVE_COLOR),t.attr("aria-expanded","true"),e.is(":visible")&&e.parent().toggleClass("show")}function headerDropdownClick(){var e=$(this).children(".dropdown-menu");e.show();var t=$(this).children("a:first-child");t.hasClass(CURRENT_NAV_LINK_CLASS)||t.css("color",NAV_LINK_ACTIVE_COLOR),t.attr("aria-expanded","true"),e.css({position:"",inset:"",margin:"",transform:""})}function headerDropdownMouseLeave(e){$(this).children(".dropdown-menu").hide();var t=$(this).children("a:first-child");t.hasClass(CURRENT_NAV_LINK_CLASS)||t.css("color","white"),t.attr("aria-expanded","false")}function headerAccountInfoHoverOrClick(e){var t=$(this).children(".dropdown-menu-end");t.addClass("show"),t.show(),t.css({position:"absolute",inset:"0px auto auto 0px",margin:"0px",transform:"translate(-96px, 67px)"});var o=$(this).children("a:first-child");o.attr("aria-expanded","true"),o.css("filter","drop-shadow(rgba(255, 255, 255, 0.5) 0px 2px 5px)")}function headerAccountInfoMouseLeave(){var e=$(this).children(".dropdown-menu-end");e.removeClass("show"),e.hide();var t=$(this).children("a:first-child");t.attr("aria-expanded","false"),t.css("filter","")}function loginDropdownHoverOrClick(){var e=$(this).children(".dropdown-menu-end");e.addClass("show"),e.show(),e.css({position:"absolute",inset:"0px auto auto 0px",margin:"0px",transform:"translate(-235px, 40px)"})}function loginDropdownMouseLeave(){var e=$(this).children(".dropdown-menu-end");e.removeClass("show"),e.hide()}function isNumeric(e){return/^\d+$/.test(e)}function uid(){return"id"+Math.random().toString(16).slice(2)}function hasOnlySpacesAndDigits(e){return/^(?=.*\d)[\d ]+$/.test(e)}function validateUsername(e){return/^[A-ZÀ-Ÿa-z]{4}[A-ZÀ-Ÿa-z0-9-_]{0,11}$/.test(e)}function validateFullName(e){return/^(?:[A-ZÀ-Ÿa-z]+(?:-[A-ZÀ-Ÿa-z]+)*)+[\s]+(?:[A-ZÀ-Ÿa-z]+(?:-[A-ZÀ-Ÿa-z]+)*)+[\s]*(?:[A-ZÀ-Ÿa-z]+(?:-[A-ZÀ-Ÿa-z]+)*)*$/.test(e)}function signupAndEditSubmit(e){var t=$(".js-errors");t.text("");var o=e.target,r=e.data,a=!1,n=!1,s=!1,i=!1;if(validateFullName(o.full_name.value)?n=!0:t.append("<p>"+r.fullNameError+"</p>"),validateUsername(o.username.value)?a=!0:t.append("<p>"+r.usernameError+"</p>"),"edit-profile-form"==o.name)i=!0;else{var l=o.password1.value;l.length<MIN_PASSWORD_LENGTH||isNumeric(l)?t.append("<p>"+r.passwordError+"</p>"):i=!0}var c=$("tbody .js-number"),d=[];c.each(function(){d.push(this.value)}),s=!0;for(var u=0;u<d.length;u++)if(!hasOnlySpacesAndDigits(d[u])){s=!1,t.append("<p>"+r.phoneNumError+"</p>");break}var p=$("tbody .checkboxinput"),f=[];p.each(function(){f.push(this.checked)});var m=f.length;for(u=0;u<m&&!f[u];u++)u==m-1&&(s=!1,t.append("<p>"+r.whatsAppError+"</p>"));s&&i&&n&&a||(e.preventDefault(),t.addClass("alert alert-danger"),alert(r.alertContent),document.querySelector("a[name='top']").click(),window.history.replaceState({},document.title,"."))}function itemListingFormSubmit(e){var t=e.target,o=e.data,r=t.price.value,a=!1,n=!1;$(".js-gallery > .js-photo-wrp").length>=MIN_LISTING_PHOTOS&&(n=!0),hasOnlySpacesAndDigits(r)&&(a=!0),n&&a||alert(o.alertContent);var s=$(".js-photo-errors");n?(s.text(""),s.removeClass()):(e.preventDefault(),s.text("").addClass("alert alert-danger"),s.append("<p>"+o.photoError+"</p>"));var i=$(".js-price-errors");a?(i.text(""),i.removeClass()):(e.preventDefault(),i.text("").addClass("alert alert-danger"),i.append("<p>"+o.priceError+"</p>"))}function insertItemSubCategories(e){var t=parseInt($(".js-category").first().val(),10),o=$(".js-subcategory");$.ajax({url:e.data.url,data:{category_id:t},dataType:"json",success:function(e){var t=e.sub_categories;o.empty(),$.each(t,function(e,t){var r="<option value="+t.id+">"+t.name+"</option>";o.append(r)}),o.prepend(" \t\t\t\t<option value='' selected='selected'> \t\t\t\t\t--------- \t\t\t\t</option>")}})}function insertConditionHelpText(e){var t=$(".js-condition").first(),o=t.val(),r="<span class='form-text text-muted'>"+e.data.conditions[o]+"</span>";t.parent().children("span:last-child").remove(),t.after(r)}function onConditionChange(e){var t=e.target.value,o=$(".js-descrLabelText").first().text(),r=o+"*",a=$(".js-condition-description").first(),n=a.prev();"N"===t?(n.text(o),a.removeAttr("required")):(n.text(r),a.attr("required",""))}function expandImage(e){e.data.$images.css("border","none");var t=e.target;$(t).css("border","2px inset #198754"),$(".js-expanded-img").attr({src:t.src,alt:t.alt})}function displayLoginRequiredToast(){var e=$(".js-login-required-toast").first();e.css({color:"#842029","border-color":"#f5c2c7"}),new bootstrap.Toast(e[0]).show()}function displaySelfVoteToast(){var e=$(".js-self-vote-toast").first();e.css({color:"#842029","border-color":"#f5c2c7"}),new bootstrap.Toast(e[0]).show()}function displayErrorOccurredToast(){var e=$(".js-error-occurred-toast").first();e.css({color:"#842029","border-color":"#f5c2c7"}),new bootstrap.Toast(e[0]).show()}function displayBookmarkToggleToast(e){var t;t=e?$(".js-bookmark-added-toast").first():$(".js-bookmark-removed-toast").first(),new bootstrap.Toast(t[0]).show()}function displayFollowToggleToast(e){var t;t=e?$(".js-followed-toast").first():$(".js-unfollowed-toast").first(),new bootstrap.Toast(t[0]).show()}function displayCustomSuccessToast(e){var t=$(".js-custom-success-toast").first();$(".js-toast-message").html(e),new bootstrap.Toast(t[0]).show()}function displayCustomErrorToast(e){var t=$(".js-custom-error-toast").first();t.css({color:"#842029","border-color":"#f5c2c7"}),$(".js-toast-message").html(e),new bootstrap.Toast(t[0]).show()}function init(){var e=$(".js-headerDropdown"),t=$(".js-headerAccountInfo");if(!(isMobile=window.matchMedia("only screen and (max-width: 991.98px)").matches)){var o=$(".js-loginDropdown");e.hover(headerDropdownHover,headerDropdownMouseLeave),e.click(headerDropdownClick),t.hover(headerAccountInfoHoverOrClick,headerAccountInfoMouseLeave),t.click(headerAccountInfoHoverOrClick),o.hover(loginDropdownHoverOrClick,loginDropdownMouseLeave),o.click(loginDropdownHoverOrClick)}else isMobile&&(e.off(),t.off())}$window.on("resize",function(){var e=$(this).width();e!==lastWidth&&(lastWidth=e,init())}),$(document).ready(function(){init(),lastWidth=$window.width()}),$(".js-bookmark-button").click(function(e){if(!userId)return displayLoginRequiredToast(),!1;var t=$(this).children("i"),o=parseInt(this.dataset.id,10);if(t.hasClass("js-selected")){var r="recall-bookmark";$.ajax({url:bookmarkUrl,type:"POST",data:{id:o,action:r},dataType:"json",beforeSend:function(e){e.setRequestHeader("X-CSRFToken",csrfToken)},success:function(e){if(e.unbookmarked){t.removeClass("fas js-selected").addClass("far");var o=parseInt($bookmarkCounter.text(),10);$bookmarkCounter.text(o-1),t[0].nextSibling.textContent=" "+bookmarkText,displayBookmarkToggleToast(!1)}else console.error(e),displayErrorOccurredToast()}})}else{r="bookmark";$.ajax({url:bookmarkUrl,type:"POST",data:{id:o,action:r},dataType:"json",beforeSend:function(e){e.setRequestHeader("X-CSRFToken",csrfToken)},success:function(e){if(e.bookmarked){t.removeClass("far").addClass("fas js-selected");var o=parseInt($bookmarkCounter.text(),10);$bookmarkCounter.text(o+1),t[0].nextSibling.textContent=" "+bookmarkedText,displayBookmarkToggleToast(!0)}else console.error(e),displayErrorOccurredToast()}})}}),document.addEventListener("DOMContentLoaded",function(){let e={"X-Requested-With":"XMLHttpRequest","Content-Type":"application/x-www-form-urlencoded"};const t=function(e,t,r,a=2){switch(t){case-1:t="danger";break;case 0:t="success";break;case 1:t="warning"}const n="alert-"+t,s=document.createElement("div");s.classList.add("h6"),s.classList.add("alert"),s.classList.add(n),s.innerHTML=r,e.prepend(s),o(s),function(e,t){let o=0,r=setInterval(function(){o>=1&&(o=1,clearInterval(r)),e.style.opacity=o,o+=1/(50*t)},20)}(s,a),setTimeout(()=>{!function(e,t){let o=1,r=setInterval(function(){o<=0&&(o=0,clearInterval(r)),e.style.opacity=o,o-=1/(100*t)},10)}(s,a)},1e3*a),setTimeout(()=>{s.remove()},2e3*a)},o=function(e){const t="fixed"===e.style.position;e.scrollTop>200&&!t&&e.setAttribute("style","{'position': 'fixed', 'top': '0px'}"),e.scrollTop<200&&t&&e.setAttribute("style","{'position': 'static', 'top': '0px'}")},r=function(e){e.style.display="none",e.querySelector("form").reset(),e.querySelector("textarea").style.display="none"},a=function(e){e.currentTarget.nextElementSibling.style.display="block"},n=function(e){s(e.currentTarget,"remove")},s=function(o,s="add"){let l,c=null,d=null;"add"!==s?(s="remove",l=o):(l=o.closest(".report-modal-form-combined").firstElementChild,d=o.querySelector('input[name="reason"]:checked').value,c=o.querySelector("textarea").value);const u=l.getAttribute("data-url"),p=l.getAttribute("data-app-name"),f=l.getAttribute("data-model-name"),m=l.getAttribute("data-model-id"),h=l.getAttribute("data-csrf"),v={app_name:p,model_name:f,model_id:m};d&&(v.reason=d),c&&(v.info=c);const g=function(e){return Object.keys(e).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&")}(v);e["X-CSRFToken"]=h,fetch(u,{method:"post",headers:e,body:g}).then(function(e){return e.json()}).then(function(e){const o=["user-has-flagged","fas"],s=["user-has-not-flagged","far"],c=l.querySelector(".flag-icon");if(e){t(l.parentElement,e.status,e.msg);const d=l.nextElementSibling;let u;1===e.flag?(u="add",r(d),l.removeEventListener("click",a),l.addEventListener("click",n)):(u="remove",l.removeEventListener("click",n),l.addEventListener("click",a),i(l)),function(e,t,o,r){"add"===r?(e.classList.add(...t),e.classList.remove(...o)):(e.classList.remove(...t),e.classList.add(...o))}(c,o,s,u),function(e,t){var o=e.querySelector("span").querySelector("span");if(o=document.querySelector(".js-first-child").previousElementSibling)if("add"==t){var r=document.querySelector(".js-remove-flag").textContent;o.textContent=r}else r=document.querySelector(".js-report-content").textContent,o.textContent=r}(l,u),function(e,t){const o=e.querySelector("span");if(o.hasAttribute("title"))if("add"==t){var r=document.querySelector(".js-remove-flag").textContent;o.setAttribute("title",r)}else r=document.querySelector(".js-report-content").textContent,o.setAttribute("title",r)}(l,u)}}).catch(function(e){console.error(e),displayCustomErrorToast(document.querySelector(".js-flag-alert-msg").textContent)})},i=function(e,t=null){t||(t=e.nextElementSibling.parentElement);const o=t.querySelector(".flag-report-modal");e.addEventListener("click",a),t.querySelector(".report-modal-close").onclick=function(){r(o)};const n=t.querySelector(".report-modal-form"),i=n.querySelector(".last-flag-reason"),l=n.querySelector(".report-modal-form-info");n.onchange=function(e){e.target.value===i.value?(l.required=!0,l.style.display="block"):(l.style.display="none",l.removeAttribute("required"))},n.onsubmit=function(e){e.preventDefault(),s(n,"add")}},l=document.getElementsByClassName("report-modal-form-combined");for(const e of l){const t=e.querySelector(".flag-report-modal");window.onclick=function(e){e.target==t&&r(t)};const o=e.querySelector(".flag-report-icon");o.querySelector(".flag-icon").classList.contains("user-has-not-flagged")?i(o,e):o.addEventListener("click",n)}});