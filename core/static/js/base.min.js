"use strict";var lastWidth,NAV_LINK_ACTIVE_COLOR="#0e1e0a",CURRENT_NAV_LINK_CLASS="nav-menu__link--current",MIN_PASSWORD_LENGTH=8,MIN_LISTING_PHOTOS=3,$window=$(window),isMobile=window.matchMedia("only screen and (max-width: 991.98px)").matches;function headerDropdownHover(e){var t=$(this),r=t.children(".dropdown-menu");r.show();var a=t.children("a:first-child");a.hasClass(CURRENT_NAV_LINK_CLASS)||a.css("color",NAV_LINK_ACTIVE_COLOR),a.attr("aria-expanded","true"),r.is(":visible")&&r.parent().toggleClass("show")}function headerDropdownClick(e){var t=$(this),r=t.children(".dropdown-menu");r.show();var a=t.children("a:first-child");a.hasClass(CURRENT_NAV_LINK_CLASS)||a.css("color",NAV_LINK_ACTIVE_COLOR),a.attr("aria-expanded","true"),r.css({position:"",inset:"",margin:"",transform:""})}function headerDropdownMouseLeave(e){var t=$(this);t.children(".dropdown-menu").hide();var r=t.children("a:first-child");r.hasClass(CURRENT_NAV_LINK_CLASS)||r.css("color","white"),r.attr("aria-expanded","false")}function headerAccountInfoHoverOrClick(e){var t=$(this),r=t.children(".dropdown-menu-end");r.addClass("show"),r.show(),r.css({position:"absolute",inset:"0px auto auto 0px",margin:"0px",transform:"translate(-96px, 67px)"});var a=t.children("a:first-child");a.attr("aria-expanded","true"),a.css("filter","drop-shadow(rgba(255, 255, 255, 0.5) 0px 2px 5px)")}function headerAccountInfoMouseLeave(e){var t=$(this),r=t.children(".dropdown-menu-end");r.removeClass("show"),r.hide();var a=t.children("a:first-child");a.attr("aria-expanded","false"),a.css("filter","")}function loginDropdownHoverOrClick(e){var t=$(this).children(".dropdown-menu-end");t.addClass("show"),t.show(),t.css({position:"absolute",inset:"0px auto auto 0px",margin:"0px",transform:"translate(-235px, 40px)"})}function headerLangDropdownHover(e){var t=$(this),r=t.find(".dropdown-menu");r.addClass("show"),r.show(),t.find(".dropdown-toggle").attr("aria-expanded","true")}function headerLangDropdownMouseLeave(e){var t=$(this),r=t.find(".dropdown-menu");r.removeClass("show"),r.hide(),t.find(".dropdown-toggle").attr("aria-expanded","false")}function loginDropdownMouseLeave(e){var t=$(this).children(".dropdown-menu-end");t.removeClass("show"),t.hide()}function isNumeric(e){return/^\d+$/.test(e)}function isElementInViewport(e){e instanceof jQuery&&(e=e[0]);var t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=$window.height()&&t.right<=$window.width()}function decodeHtml(e){var t=document.createElement("textarea");return t.innerHTML=e,0===t.childNodes.length?"":t.value}function setAttributes(e,t){for(var r in e instanceof jQuery&&(e=e[0]),t)e.setAttribute(r,t[r])}function uid(){return"id"+Math.random().toString(16).slice(2)}function hasOnlySpacesAndDigits(e){return/^(?=.*\d)[\d ]+$/.test(e)}function validateUsername(e){return/^[A-ZÀ-Ÿa-z]{4}[A-ZÀ-Ÿa-z0-9-_]{0,11}$/.test(e)}function headerSearchSubmit(e){""==e.target.querySelector("input").value.trim()&&e.preventDefault()}function signupAndEditSubmit(e){var t=$(".js-errors");t.text("");var r=e.target,a=e.data,o=!1,s=!1,n=!1;if("true"!=r.username.dataset.valid?t.append("<p>"+a.usernameError+"</p>"):o=!0,"edit-profile-form"==r.name)n=!0;else{var i=r.password1.value;i.length<MIN_PASSWORD_LENGTH||isNumeric(i)?t.append("<p>"+a.passwordError+"</p>"):n=!0}var l=$("tbody .js-number"),d=[];l.each(function(){d.push(this.value)}),s=!0;for(var c=0;c<d.length;c++)if(!hasOnlySpacesAndDigits(d[c])){s=!1,t.append("<p>"+a.phoneNumError+"</p>");break}if(document.querySelector("#checkWhatsapp")){var u=$("tbody .checkboxinput"),f=[];u.each(function(){f.push(this.checked)});for(var m=f.length,c=0;c<m&&!f[c];c++)c==m-1&&(s=!1,t.append("<p>"+a.whatsAppError+"</p>"))}(!s||!n||!o)&&(e.preventDefault(),t.addClass("alert alert-danger"),displayToast("CUSTOM_ERROR",a.alertContent),document.querySelector("a[name='top']").click(),window.history.replaceState({},document.title,"."))}const CONTACT_FORM_NAMES=["ad-listing-form","item-listing-form","lost-item-form","found-item-form","requested-item-form"],REQUIRED_CKEDITOR_FORM_NAMES=["ad-listing-form","item-listing-form","discuss-question-form"];var $allForms=$(`
	[name='ad-listing-form'], [name='item-listing-form'],
	[name='found-item-form'], [name='lost-item-form'],
	[name='requested-item-form'], [name='past-paper-form'],
	[name='discuss-question-form'], [name='academic-question-form'],
	[name='social-profile-form'], [name='signup-form'], [name='edit-profile-form']
`);function itemListingFormSubmit(e){var t=e.target,r=e.data,a=t.price.value,o=!1,s=$(".js-gallery > .js-photo-wrp").length,n=!1;s>=MIN_LISTING_PHOTOS&&(n=!0),hasOnlySpacesAndDigits(a)&&(o=!0),n&&o||displayToast("CUSTOM_ERROR",r.alertContent);var i=$(".js-photo-errors");n?(i.text(""),i.removeClass()):(e.preventDefault(),i.text("").addClass("alert alert-danger"),i.append("<p>"+r.photoError+"</p>"));var l=$(".js-price-errors");o?(l.text(""),l.removeClass()):(e.preventDefault(),l.text("").addClass("alert alert-danger"),l.append("<p>"+r.priceError+"</p>"))}function insertCities(e){var t=parseInt($(".js-country").first().val(),10),r=$(".js-city");$.ajax({url:e.data.url,data:{country_id:t},dataType:"json",success:function(e){var t=e.cities;r.empty(),$.each(t,function(e,t){var a="<option value="+t.id+">"+t.name+"</option>";r.append(a)})}})}function insertItemSubCategories(e){var t=parseInt($(".js-category").first().val(),10),r=$(".js-subcategory");$.ajax({url:e.data.url,data:{category_id:t},dataType:"json",success:function(e){var t=e.sub_categories;r.empty(),$.each(t,function(e,t){var a="<option value="+t.id+">"+t.name+"</option>";r.append(a)})}})}function insertConditionHelpText(e){var t=$(".js-condition").first(),r=t.val(),a="<span class='form-text text-muted'>"+e.data.conditions[r]+"</span>";t.parent().children("span:last-child").remove(),t.after(a)}function onConditionChange(e){var t=e.target.value,r=$(".js-descrLabelText").first().text(),a=$(".js-condition-description").first(),o=a.prev();"N"===t?(o.text(r),a.removeAttr("required")):(o.text(r+"*"),a.attr("required",""))}function expandImage(e){e.data.$images.css("border","none");var t=e.target;$(t).css("border","2px inset #198754"),$(".js-expanded-img").attr({src:t.src,alt:t.alt})}function displayToast(e,t){if(!["LOGIN_REQUIRED","SELF_VOTE","ERROR_OCCURRED","FOLLOW_TOGGLE","CUSTOM_SUCCESS","CUSTOM_ERROR","BOOKMARK_TOGGLE","FLAG_SUCCESS","FLAG_ERROR",].includes(e))throw`${e} is an invalid toast type`;var r,a={color:"#842029","border-color":"#f5c2c7"};if("LOGIN_REQUIRED"==e)(r=$(".js-login-required-toast").first()).css(a);else if("SELF_VOTE"==e)(r=$(".js-self-vote-toast").first()).css(a);else if("ERROR_OCCURRED"==e)(r=$(".js-error-occurred-toast").first()).css(a);else if("BOOKMARK_TOGGLE"==e)r=t?$(".js-bookmark-added-toast").first():$(".js-bookmark-removed-toast").first();else if("FOLLOW_TOGGLE"==e)r=t?$(".js-followed-toast").first():$(".js-unfollowed-toast").first();else if("CUSTOM_SUCCESS"==e){var o=t,s=(r=$(".js-custom-success-toast").first()).find(".js-toast-message");s.html(o)}else if("CUSTOM_ERROR"==e){var o=t;(r=$(".js-custom-error-toast").first()).css(a);var s=r.find(".js-toast-message");s.html(o)}else if("FLAG_SUCCESS"==e){var o=t,s=(r=$(".js-flag-success-toast").first()).find(".js-toast-message");s.html(o)}else if("FLAG_ERROR"==e){var o=t,s=(r=$(".js-flag-error-toast").first()).find(".js-toast-message");s.html(o)}new bootstrap.Toast(r[0]).show()}function init(){var e=$(".js-headerDropdown"),t=$(".js-headerAccountInfo");if(isMobile=window.matchMedia("only screen and (max-width: 991.98px)").matches)isMobile&&(e.off(),t.off());else{var r=$(".js-loginDropdown"),a=$(".js-langDropdownDesk");e.hover(headerDropdownHover,headerDropdownMouseLeave),e.click(headerDropdownClick),t.hover(headerAccountInfoHoverOrClick,headerAccountInfoMouseLeave),t.click(headerAccountInfoHoverOrClick),r.hover(loginDropdownHoverOrClick,loginDropdownMouseLeave),r.click(loginDropdownHoverOrClick),a.hover(headerLangDropdownHover,headerLangDropdownMouseLeave)}}function initTooltips(){[].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]')).map(function(e){return bootstrap.Tooltip.getOrCreateInstance(e)})}function initFooterSelects(){function e(e){e.stopPropagation(),closeAllFooterSelects(this),this.nextSibling.classList.toggle("footer-select--hide"),this.classList.toggle("footer-select-arrow--active")}function t(e){var t,r,a,o,s,n,i;for(r=0,n=(o=this.parentNode.parentNode.getElementsByTagName("select")[0]).length,s=this.parentNode.previousSibling;r<n;r++)if(o.options[r].innerHTML==this.innerHTML){for(a=0,o.selectedIndex=r,s.innerHTML=this.innerHTML,i=(t=this.parentNode.getElementsByClassName("same-as-selected")).length;a<i;a++)t[a].classList.remove("same-as-selected");this.classList.add("same-as-selected");break}s.click()}function r(e,t){var r=e.parentElement;if(r.selectedIndex!=e.index){var a=document.querySelector("#footer-country-form");r.selectedIndex=e.index,a.submit()}}function a(e,t){var r=e.parentElement;if(r.selectedIndex!=e.index){var a=document.querySelector("#footer-language-form");r.selectedIndex=e.index,a.submit()}}for(s=0,i=(o=document.getElementsByClassName("js-footer-select-wrp")).length;s<i;s++){for(l=(d=o[s].getElementsByTagName("select")[0]).length,(c=document.createElement("DIV")).setAttribute("class","footer-select-selected"),c.innerHTML=d.options[d.selectedIndex].innerHTML,o[s].appendChild(c),(u=document.createElement("DIV")).setAttribute("class","footer-select-items footer-select--hide"),n=1;n<l;n++){var o,s,n,i,l,d,c,u,f,m,p=d.options[n];(f=document.createElement("DIV")).classList.add("footer-select-items-div"),f.innerHTML=p.innerHTML,d.classList.contains("js-footer-select--country")?f.addEventListener("click",r.bind(this,p)):d.classList.contains("js-footer-select--language")?f.addEventListener("click",a.bind(this,p)):f.addEventListener("click",t),u.appendChild(f)}o[s].appendChild(u),c.addEventListener("click",e);var h=o[s].getElementsByClassName("footer-select-items-div");for(m=0;m<h.length;m++)if(d.selectedIndex-1==m){h[m].classList.add("same-as-selected");break}}}function closeAllFooterSelects(e){var t,r,a,o,s,n=[];for(a=0,t=document.getElementsByClassName("footer-select-items"),r=document.getElementsByClassName("footer-select-selected"),o=t.length,s=r.length;a<s;a++)e==r[a]?n.push(a):r[a].classList.remove("footer-select-arrow--active");for(a=0;a<o;a++)n.indexOf(a)&&t[a].classList.add("footer-select--hide")}$allForms.dirty({preventLeaving:!0,leavingMessage:"{% trans 'There are unsaved changes on this page which will be discarded if you leave.' %}"}),$allForms.on("submit",function(e){if(CONTACT_FORM_NAMES.includes(this.name)){var t,r=!1,a=this.querySelectorAll("#div_id_contact_numbers [type=checkbox]");for(var o of a)if(o.checked){r=!0;break}r||(e.preventDefault(),displayToast("CUSTOM_ERROR",(t=document.querySelector(".js-contactErrMsg")).textContent))}REQUIRED_CKEDITOR_FORM_NAMES.includes(this.name)&&""==document.querySelector("iframe.cke_wysiwyg_frame").contentDocument.querySelector("body").textContent.trim()&&(e.preventDefault(),displayToast("CUSTOM_ERROR",(t=document.querySelector(".js-ckeditorEmptyMsg")).textContent))}),$window.on("resize",function(){var e=$(this).width();e!==lastWidth&&(lastWidth=e,init())}),$(document).ready(function(){init(),initTooltips(),initFooterSelects(),lastWidth=$window.width()}),$(".js-bookmark-button").click(function(e){if(!userId)return displayToast("LOGIN_REQUIRED"),!1;var t=$(this).children("i"),r=parseInt(this.dataset.id,10);if(t.hasClass("js-selected")){var a="recall-bookmark";$.ajax({url:bookmarkUrl,type:"POST",data:{id:r,action:a},dataType:"json",beforeSend:function(e){e.setRequestHeader("X-CSRFToken",csrfToken)},success:function(e){if(t.removeClass("fas js-selected").addClass("far"),"undefined"!=typeof $bookmarkCounter){var r=parseInt($bookmarkCounter.text(),10);$bookmarkCounter.text(r-1)}t[0].nextSibling.textContent=" "+bookmarkText,displayToast("BOOKMARK_TOGGLE",!1)},error:function(){displayToast("ERROR_OCCURRED")}})}else{var a="bookmark";$.ajax({url:bookmarkUrl,type:"POST",data:{id:r,action:a},dataType:"json",beforeSend:function(e){e.setRequestHeader("X-CSRFToken",csrfToken)},success:function(e){if(t.removeClass("far").addClass("fas js-selected"),"undefined"!=typeof $bookmarkCounter){var r=parseInt($bookmarkCounter.text(),10);$bookmarkCounter.text(r+1)}t[0].nextSibling.textContent=" "+bookmarkedText,displayToast("BOOKMARK_TOGGLE",!0)},error:function(){displayToast("ERROR_OCCURRED")}})}});var headers={"X-Requested-With":"XMLHttpRequest","Content-Type":"application/x-www-form-urlencoded"};const toggleClass=function(e,t,r,a){"add"===a?(e.classList.add(...t),e.classList.remove(...r)):(e.classList.remove(...t),e.classList.add(...r))},toggleText=function(e,t){var r=document.querySelector(".js-flagHelper");if(r){if("add"==t){var a=document.querySelector(".js-remove-flag").textContent;r.textContent=a}else{var a=document.querySelector(".js-report-content").textContent;r.textContent=a}}},toggleTitle=function(e,t){let r=e.querySelector("span");if(r.hasAttribute("title")){if("add"==t){var a=document.querySelector(".js-remove-flag").textContent;r.setAttribute("title",a)}else{var a=document.querySelector(".js-report-content").textContent;r.setAttribute("title",a)}}},hideModal=function(e){e.style.display="none",e.querySelector("form").reset(),e.querySelector("textarea").style.display="none"},showModal=function(e){let t=e.currentTarget.nextElementSibling;t.style.display="block"},removeFlag=function(e){submitFlagForm(e.currentTarget,"remove")},convertDataToURLQuery=function(e){return Object.keys(e).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])}).join("&")},submitFlagForm=function(e,t="add"){var r,a=null,o=null;if("add"!==t)t="remove",r=e;else{r=e.closest(".report-modal-form-combined").firstElementChild,o=e.querySelector('input[name="reason"]:checked').value;var s=e.querySelector("textarea");if(a=s.value.trim(),"100"==o&&""==a){s.focus();return}}let n=r.getAttribute("data-url"),i=r.getAttribute("data-app-name"),l=r.getAttribute("data-model-name"),d=r.getAttribute("data-model-id"),c=r.getAttribute("data-csrf"),u={app_name:i,model_name:l,model_id:d};o&&(u.reason=o),a&&(u.info=a);let f=convertDataToURLQuery(u);headers["X-CSRFToken"]=c,fetch(n,{method:"post",headers:headers,body:f}).then(function(e){return e.json()}).then(function(e){if(e){var t,a;let o=r.querySelector(".flag-icon");switch(e.status){case 0:displayToast("FLAG_ERROR",e.msg);break;case 1:displayToast("FLAG_SUCCESS",e.msg)}let s=r.nextElementSibling;1===e.flag?(t="add",hideModal(s),r.removeEventListener("click",showModal),r.addEventListener("click",removeFlag)):(t="remove",r.removeEventListener("click",removeFlag),r.addEventListener("click",showModal),prepareFlagModal(r)),["DiscussComment","AcademicComment"].includes(document.querySelector(".js-flag-report-icon").dataset.modelName)||(toggleClass(o,["user-has-flagged","fas"],["user-has-not-flagged","far"],t),toggleText(r,t),toggleTitle(r,t))}}).catch(function(e){console.error(e),displayToast("FLAG_ERROR",document.querySelector(".js-flag-alert-msg").textContent)})},prepareFlagModal=function(e,t=null){t||(t=e.nextElementSibling.parentElement);let r=t.querySelector(".flag-report-modal");e.addEventListener("click",showModal);let a=t.querySelector(".report-modal-close");a.onclick=function(){hideModal(r)};let o=t.querySelector(".report-modal-form"),s=o.querySelector(".last-flag-reason"),n=o.querySelector(".report-modal-form-info");o.onchange=function(e){e.target.value===s.value||e.target==n?(n.required=!0,n.style.display="block",n.focus()):(n.style.display="none",n.removeAttribute("required"))},o.onsubmit=function(e){e.preventDefault(),submitFlagForm(o,"add")}};document.addEventListener("DOMContentLoaded",function(){let e=document.getElementsByClassName("report-modal-form-combined");for(let t of e){let r=t.querySelector(".flag-report-modal");window.onclick=function(e){e.target==r&&hideModal(r)};let a=t.querySelector(".flag-report-icon"),o=a.querySelector(".flag-icon");o.classList.contains("user-has-not-flagged")?prepareFlagModal(a,t):a.addEventListener("click",removeFlag)}}),document.addEventListener("click",function(e){closeAllFooterSelects()});