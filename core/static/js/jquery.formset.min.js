(function(c){c.fn.formset=function(g){var a=c.extend({},c.fn.formset.defaults,g),A=a.extraClasses.join(" "),l=c("#id_"+a.prefix+"-TOTAL_FORMS"),q=c("#id_"+a.prefix+"-MAX_NUM_FORMS"),r=c("#id_"+a.prefix+"-MIN_NUM_FORMS");g=c(this);var t=function(b,d){a.extraClasses&&(b.removeClass(A),b.addClass(a.extraClasses[d%a.extraClasses.length]))},u=function(b,d,f){var h=new RegExp(d+"-(\\d+|__prefix__)-");d=d+"-"+f+"-";b.attr("for")&&b.attr("for",b.attr("for").replace(h,d));b.attr("id")&&b.attr("id",b.attr("id").replace(h,
    d));b.attr("name")&&b.attr("name",b.attr("name").replace(h,d))},v=function(){return 0==q.length||""==q.val()||0<q.val()-l.val()},w=function(){return 0==r.length||""==r.val()||0<l.val()-r.val()},z=function(b){var d=c.trim(a.deleteCssClass).replace(/\s+/g,"."),f=c.trim(a.addCssClass).replace(/\s+/g,"."),h='<a class="'+a.deleteCssClass+'" href="javascript:void(0)">'+a.deleteText+"</a>";a.deleteContainerClass?b.find('[class*="'+a.deleteContainerClass+'"]').append(h):b.is("TR")?b.children(":last").append(h):
    b.is("UL")||b.is("OL")?b.append("<li>"+h+"</li>"):b.append(h);w()||b.find("a."+d).hide();b.find("a."+d).click(function(){var m=c(this).parents("."+a.formCssClass),x=m.find('input:hidden[id $= "-DELETE"]'),y=m.siblings("a."+f+", ."+a.formCssClass+"-add");if(x.length){x.val("on");m.hide();var n=c("."+a.formCssClass).not(":hidden")}else m.remove(),n=c("."+a.formCssClass).not(".formset-custom-template");l.val(n.length);for(var k=0,B=n.length;k<B;k++)t(n.eq(k),k),x.length||n.eq(k).find("input,select,textarea,label,div").each(function(){u(c(this),
    a.prefix,k)});w()||c("a."+d).each(function(){c(this).hide()});y.is(":hidden")&&v()&&y.show();a.removed&&a.removed(m);return!1})};g.each(function(b){var d=c(this),f=d.find('input:checkbox[id $= "-DELETE"]');f.length&&(f.is(":checked")?(f.before('<input type="hidden" name="'+f.attr("name")+'" id="'+f.attr("id")+'" value="on" />'),d.hide()):f.before('<input type="hidden" name="'+f.attr("name")+'" id="'+f.attr("id")+'" />'),c('label[for="'+f.attr("id")+'"]').hide(),f.remove());0<d.find("input,select,textarea,label,div").length&&
    (d.addClass(a.formCssClass),d.is(":visible")&&(z(d),t(d,b)))});if(g.length){var C=!v();if(a.formTemplate){var e=a.formTemplate instanceof c?a.formTemplate:c(a.formTemplate);e.removeAttr("id").addClass(a.formCssClass+" formset-custom-template");e.find("input,select,textarea,label,div").each(function(){u(c(this),a.prefix,"__prefix__")});z(e)}else a.hideLastAddForm&&c("."+a.formCssClass+":last").hide(),e=c("."+a.formCssClass+":last").clone(!0).removeAttr("id"),e.find('input:hidden[id $= "-DELETE"]').remove(),
    e.find("input,select,textarea,label,div").not(a.keepFieldValues).each(function(){var b=c(this);b.is("input:checkbox")||b.is("input:radio")?b.attr("checked",!1):b.val("")});a.formTemplate=e;e='<a class="'+a.addCssClass+'" href="javascript:void(0)">'+a.addText+"</a>";if(a.addContainerClass){var p=c('[class*="'+a.addContainerClass+'"');p.append(e);e=p.find('[class="'+a.addCssClass+'"]')}else g.is("TR")?(p=g.eq(0).children().length,e=c('<tr><td colspan="'+p+'">'+e+"</tr>").addClass(a.formCssClass+"-add"),
    g.parent().append(e),e=e.find("a")):(g.filter(":last").after(e),e=g.filter(":last").next());C&&e.hide();e.click(function(){var b=parseInt(l.val()),d=a.formTemplate.clone(!0).removeClass("formset-custom-template"),f=c(c(this).parents("tr."+a.formCssClass+"-add").get(0)||this),h=c.trim(a.deleteCssClass).replace(/\s+/g,".");t(d,b);d.insertBefore(f).show();d.find("input,select,textarea,label,div").each(function(){u(c(this),a.prefix,b)});l.val(b+1);w()&&c("a."+h).each(function(){c(this).show()});v()||
    f.hide();a.added&&a.added(d);return!1})}return g};c.fn.formset.defaults={prefix:"form",formTemplate:null,addText:"add another",deleteText:"remove",addContainerClass:null,deleteContainerClass:null,addCssClass:"add-row",deleteCssClass:"delete-row",formCssClass:"dynamic-form",extraClasses:[],keepFieldValues:"",added:null,removed:null,hideLastAddForm:!1}})(jQuery);